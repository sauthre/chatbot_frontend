<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Join Flarefix Room</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center">

  <div class="bg-white p-6 rounded-xl shadow-lg w-80">
    <h1 class="text-lg font-semibold mb-4">Join Secret Room</h1>

    <input id="room_id" class="w-full border px-3 py-2 rounded mb-3"
           placeholder="Room ID" />

    <input id="passcode" class="w-full border px-3 py-2 rounded mb-3"
           placeholder="Passcode" />

    <button id="joinBtn"
            class="w-full bg-black text-white py-2 rounded-lg">
      Join Room
    </button>

    <p id="status" class="text-sm text-red-600 mt-3"></p>
  </div>

<script>
const supabase = supabase.createClient(
  "https://kjmyyewjwgaxnlacszja.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqbXl5ZXdqd2dheG5sYWNzemphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwNTY2OTUsImV4cCI6MjA3OTYzMjY5NX0.x1X8wpoFzERH4ZOxoDi-7OHzWmsqvbt8nGJpM2G_p8w"
);

document.getElementById("joinBtn").onclick = async () => {
  const room_id = document.getElementById("room_id").value.trim();
  const passcode = document.getElementById("passcode").value.trim();
  const status = document.getElementById("status");

  const { data, error } = await supabase
    .from("rooms")
    .select("*")
    .eq("room_id", room_id)
    .eq("passcode", passcode)
    .maybeSingle();

  if (!data) {
    status.textContent = "Invalid Room ID or Passcode!";
    return;
  }

  // Redirect to chat
  window.location.href = `secret-chat.html?room=${room_id}`;
};
</script>

</body>
</html>
